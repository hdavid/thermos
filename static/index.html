<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv='Content-type' content='text/html; charset=utf-8'>
    <title>Thermos</title>
  </head>
	<style type="text/css" media="screen"> @import url("site.css");   </style>
  <body>
	
	<script src="js/react.js"></script>
	<script src="js/JSXTransformer.js"></script>
	<script src="js/jquery-1.10.0.min.js"></script>
	<script src="thermos.js" type="text/jsx"></script>
	<script src="js/jquery.flot.js"></script>
	<script src="js/jquery.flot.time.js"></script>
	<script src="thermos.js" type="text/jsx"></script>

   	<h1>Thermos</h1>

	<div id='notice'></div>
	
	<div id="status"></div> 
	
	<div id="configForm"></div>
	
	<div id="schedule"></div>
	<br/>
	<div id="scheduleEntryForm"></div>
	
	<div id="test"></div>

    <script type="text/jsx">

		var rest_api = "";//use ourselves as api url. so we can leave that empty.
	
		React.render(
		  	<ConfigForm url={rest_api+"config.json"} name="config"/>, 
			document.getElementById('configForm')
		);
	
		React.render(
			<Status url={rest_api+"status.json"} name="status"/>,
			document.getElementById('status')
		);

		React.render(
			<Schedule url={rest_api+"schedule.json"} name="schedule"/>,
			document.getElementById('schedule')
		);
	
    </script>
	<a href="thermos.log">thermos.log</a>
	<a href="restApi.log">restApi.log</a>
	
	<h2 onClick="requestPlot()">Graph</h2>
	<div id="placeholder" class="demo-placeholder" style="width:100%;height:250px"></div>
	<script type="text/javascript">

		function plot(data) {
			$.plot(
				"#placeholder",
				[
					{ label: "mode", data: data.timeseries[0] },
					{ label: "heating", data: data.timeseries[1] },
					{ label: "scheduled", data: data.timeseries[2] },
					{ label: "actual", data: data.timeseries[3] },
	 			],
				{
					legend:{           
					            position: 'sw'
					        },
					
							series: {
								lines: {
									show: true
								},
								points: {
									show: true
								}
							},
							grid: {
								hoverable: true,
								clickable: true
							}
				,
					xaxis: { 
						mode: "time",
						min: data.time[0],
						max: data.time[data.time.length-1] 
					}
				}
			);
			$("<div id='tooltip'></div>").css({
				position: "absolute",
				display: "none",
				border: "1px solid #fdd",
				padding: "2px",
				"background-color": "#fee",
				opacity: 0.80
			}).appendTo("body");

			$("#placeholder").bind("plothover", function (event, pos, item) {

				if (false && $("#enablePosition:checked").length > 0) {
					var str = "(" + pos.x.toFixed(2) + ", " + pos.y.toFixed(2) + ")";
					$("#hoverdata").text(str);
				}

				if (true || $("#enableTooltip:checked").length > 0) {
					if (item) {
						var x = item.datapoint[0].toFixed(2),
							y = item.datapoint[1].toFixed(2);

						$("#tooltip").html(item.series.label + " : " + y)
							.css({top: item.pageY+5, left: item.pageX+5})
							.fadeIn(200);
					} else {
						$("#tooltip").hide();
					}
				}
			});

			$("#placeholder").bind("plotclick", function (event, pos, item) {
				if (item) {
					$("#clickdata").text(" - click point " + item.dataIndex + " in " + item.series.label);
					plot.highlight(item.series, item.datapoint);
				}
			});
		};
		
		function requestPlot(){
			$.ajax({
	      		url: 'stats.log',
	      		dataType: 'json',
	      		success: function(data) {
					try {
					    plot(data);
					} catch(err) {
						console.error('stats.log', status, err.message);
						$('#notice').html("error parsing data for 'stats.log' ! "+err.toString()).show().fadeOut(2000);
					}
	      		}.bind(this),
	      		error: function(xhr, status, err) {
	        		console.error('stats.log', status, err.toString());
					$('#notice').html("error loading 'stats.log' ! "+err.toString()).show().fadeOut(2000);
	      		}.bind(this)
	    	});
		};
		
		</script>
	
		
  </body>
</html>
